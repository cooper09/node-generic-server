var xml = require('xml');
var builder = require('xmlbuilder');

var models = require('./models');
var RichMediaAd   = models.RichMediaAd;
var ImageAd       = models.ImageAd;
var TextAd        = models.TextAd;

var pretty_xml = false

module.exports.createRichMediaAd = function (content, width, height, beacons) {
  console.log("generating rich media ad");
  var d = {content: {_cdata:content}, width:width, height:height, beacons:beacons.length > 0 ? beacons:null};
  var ad = new RichMediaAd( d );
  return admarkup(ad, "richmediaAd");
}

module.exports.createTextAd = function (clickText, clickUrl, toolTip, additionalText, beacons) {
  console.log("generating text ad");
  var d = {clickText: clickText, clickUrl:clickUrl, toolTip:toolTip, additionalText:additionalText, beacons:beacons.length > 0 ? beacons:null};
  var ad = new TextAd( d );
  return admarkup(ad, "textAd");
}

module.exports.createImageAd = function (clickUrl, imgUrl, width, height, toolTip, additionalText, beacons) {
  console.log("generating image ad");
  var d = { clickUrl: clickUrl, imgUrl:imgUrl, width:width, height:height, toolTip:toolTip, additionalText:additionalText, beacons:beacons.length > 0 ? beacons:null};
  var ad = new ImageAd( d );
  return admarkup(ad, "imageAd");
}

function admarkup(ad, type){
  var output = builder.create( {"ad":{"@modelVersion":"0.9"}} ).ele( type ).ele( ad ).end({pretty:pretty_xml});
  return output;
}